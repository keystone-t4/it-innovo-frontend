import{ak as N,g as B,A as n,o as i,c as l,a as s,y as p,al as v,t as m,ag as c,aj as U,v as g,r as y,_ as E}from"./BzE9pA6t.js";import{u as S,a as I}from"./B9GDI4c5.js";function x(e){return e.replace(/\D/g,"")}function O(e){return/^[0-9+()\-\s]+$/.test(e)}function j(e){if(!e.trim()||!O(e))return!1;const r=x(e);return r.length>=10&&r.length<=15}function z(e){return x(e)}function D(){return new Date().toISOString().split("T")[0]}function H(){return new Date().toTimeString().slice(0,5)}function R(e){const r=new Date;r.setHours(0,0,0,0);const u=new Date(e);return u.setHours(0,0,0,0),u<r}function $(e,r){const u=new Date;return new Date(`${e}T${r}`)<u}const M=S(),k=I();function G(e){const r=N({});return{fieldErrors:r,validate:()=>(Object.keys(r).forEach(o=>delete r[o]),e.ttn_number?.trim()||(r.ttn_number="Введите номер ТТН"),e.unload_date||(r.unload_date="Выберите дату разгрузки"),e.unload_date&&R(e.unload_date)&&(r.unload_date="Дата разгрузки не может быть в прошлом"),e.unload_start_time||(r.unload_start_time="Укажите время начала"),e.unload_date&&e.unload_start_time&&!r.unload_date&&$(e.unload_date,e.unload_start_time)&&(r.unload_start_time="Время разгрузки не может быть в прошлом"),e.product_name?.trim()||(r.product_name="Укажите наименование продукта"),(e.weight_ttn===null||Number.isNaN(e.weight_ttn)||e.weight_ttn<=0)&&(r.weight_ttn="Укажите корректный вес"),e.driver_phone?.trim()?j(e.driver_phone)||(r.driver_phone="Некорректный номер телефона — допустимо 10–15 цифр"):r.driver_phone="Укажите телефон водителя",e.ttn_number&&M.requests.some(o=>o.ttn_number===e.ttn_number)&&(r.ttn_number="Заявка с таким ТТН уже существует"),k.currentDriverId||(r.driver="Не выбран водитель"),k.currentArrivalPlaceId||(r.arrival_place="Не выбрано место прибытия"),Object.keys(r).length===0),normalizeForm:()=>({...e,driver_phone:z(e.driver_phone),weight_ttn:e.weight_ttn?Number(e.weight_ttn):NaN}),resetForm:()=>{e.ttn_number="",e.unload_date="",e.unload_start_time="",e.product_name="",e.weight_ttn=NaN,e.driver_phone=""}}}const J={class:"request-form__row"},K=["value"],L={class:"request-form__row"},Q=["value"],W={class:"request-form__row"},X=["disabled"],Y={key:0,class:"request-form__error"},Z={class:"request-form__row"},ee=["value"],te={class:"request-form__row"},se=["value"],re={class:"request-form__row"},ne=["min","disabled"],oe={key:0,class:"request-form__error"},ae={class:"request-form__row"},ie=["min","disabled"],le={key:0,class:"request-form__error"},ue={class:"request-form__row"},_e=["disabled"],de={key:0,class:"request-form__error"},me={class:"request-form__row"},ce=["disabled"],pe={key:0,class:"request-form__error"},ve={class:"request-form__row"},be=["disabled"],fe={key:0,class:"request-form__error"},qe={class:"request-form__actions"},he=["disabled"],ye={key:0},we={key:1},ge={key:0,class:"request-form__error"},De={key:1,class:"request-info"},ke={key:2,class:"request-info"},Ne=B({__name:"submit",setup(e){const r=S(),u=I(),f=g(()=>a.unload_date===D()?H():void 0),a=N({ttn_number:"",unload_date:"",unload_start_time:"",product_name:"",weight_ttn:NaN,driver_phone:""}),{fieldErrors:o,validate:P,normalizeForm:V,resetForm:A}=G(a),d=y(!1),q=y(!1),b=y(null),h=r.getCurrentDriverById(u.currentDriverId),T=r.getArrivalPlaceNameById(u.currentArrivalPlaceId),C=g(()=>r.isCurrentDriverHaveActiveRequestById(u.currentDriverId));async function F(){if(b.value=null,q.value=!1,!!P()){d.value=!0;try{await r.sendRequest({driver_id:u.currentDriverId,arrival_place_id:u.currentArrivalPlaceId,...V()}),q.value=!0,A()}catch(w){b.value=w?.message??"Не удалось отправить заявку"}finally{d.value=!1}}}return(w,t)=>n(C)?n(q)?(i(),l("p",De," Заявка успешно создана. ")):(i(),l("p",ke," У вас есть активная заявка. Бронирование станет доступно после ее выполнения или отмены. ")):(i(),l("form",{key:0,class:"request-form",onSubmit:U(F,["prevent"]),novalidate:""},[s("div",J,[t[6]||(t[6]=s("label",{class:"request-form__label"},"ФИО водителя",-1)),s("input",{class:"request-form__input",type:"text",disabled:"",value:n(h)?.full_name??""},null,8,K)]),s("div",L,[t[7]||(t[7]=s("label",{class:"request-form__label"},"Место прибытия",-1)),s("input",{class:"request-form__input",type:"text",disabled:"",value:n(T)??""},null,8,Q)]),s("div",W,[t[8]||(t[8]=s("label",{class:"request-form__label"},"Номер ТТН",-1)),p(s("input",{class:"request-form__input","onUpdate:modelValue":t[0]||(t[0]=_=>a.ttn_number=_),type:"text",disabled:n(d)},null,8,X),[[v,a.ttn_number]]),n(o).ttn_number?(i(),l("div",Y,m(n(o).ttn_number),1)):c("",!0)]),s("div",Z,[t[9]||(t[9]=s("label",{class:"request-form__label"},"Номер машины",-1)),s("input",{class:"request-form__input",type:"text",disabled:"",value:n(h)?.truck_number??""},null,8,ee)]),s("div",te,[t[10]||(t[10]=s("label",{class:"request-form__label"},"Номер прицепа",-1)),s("input",{class:"request-form__input",type:"text",disabled:"",value:n(h)?.trailer_number??""},null,8,se)]),s("div",re,[t[11]||(t[11]=s("label",{class:"request-form__label"},"Дата разгрузки",-1)),p(s("input",{class:"request-form__input","onUpdate:modelValue":t[1]||(t[1]=_=>a.unload_date=_),type:"date",min:n(D)(),disabled:n(d)},null,8,ne),[[v,a.unload_date]]),n(o).unload_date?(i(),l("div",oe,m(n(o).unload_date),1)):c("",!0)]),s("div",ae,[t[12]||(t[12]=s("label",{class:"request-form__label"},"Время начала разгрузки",-1)),p(s("input",{class:"request-form__input","onUpdate:modelValue":t[2]||(t[2]=_=>a.unload_start_time=_),type:"time",min:n(f),disabled:n(d)},null,8,ie),[[v,a.unload_start_time]]),n(o).unload_start_time?(i(),l("div",le,m(n(o).unload_start_time),1)):c("",!0)]),s("div",ue,[t[13]||(t[13]=s("label",{class:"request-form__label"},"Наименование продукта",-1)),p(s("input",{class:"request-form__input","onUpdate:modelValue":t[3]||(t[3]=_=>a.product_name=_),type:"text",disabled:n(d),placeholder:"Битум"},null,8,_e),[[v,a.product_name]]),n(o).product_name?(i(),l("div",de,m(n(o).product_name),1)):c("",!0)]),s("div",me,[t[14]||(t[14]=s("label",{class:"request-form__label"},"Вес по ТТН (kg)",-1)),p(s("input",{class:"request-form__input","onUpdate:modelValue":t[4]||(t[4]=_=>a.weight_ttn=_),type:"number",min:"0",step:"1",disabled:n(d)},null,8,ce),[[v,a.weight_ttn,void 0,{number:!0}]]),n(o).weight_ttn?(i(),l("div",pe,m(n(o).weight_ttn),1)):c("",!0)]),s("div",ve,[t[15]||(t[15]=s("label",{class:"request-form__label"},"Телефон водителя",-1)),p(s("input",{class:"request-form__input","onUpdate:modelValue":t[5]||(t[5]=_=>a.driver_phone=_),type:"tel",inputmode:"numeric",disabled:n(d),placeholder:"89312345678"},null,8,be),[[v,a.driver_phone]]),n(o).driver_phone?(i(),l("div",fe,m(n(o).driver_phone),1)):c("",!0)]),s("div",qe,[s("button",{class:"request-form__button",type:"submit",disabled:n(d)},[n(d)?(i(),l("span",ye,"Отправка...")):(i(),l("span",we,"Отправить заявку"))],8,he)]),n(b)?(i(),l("p",ge,m(n(b)),1)):c("",!0)],32))}}),xe=Object.assign(E(Ne,[["__scopeId","data-v-32820d0e"]]),{__name:"DemoDriverSubmit"});export{xe as default};
