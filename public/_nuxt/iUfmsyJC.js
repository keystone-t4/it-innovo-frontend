import{u as f,a as $}from"./fW9w5NH6.js";import{g as C,o as e,c as a,a as r,F as o,x as m,t as k,A as c,ag as x,v as h,r as B}from"./DX_H16pI.js";const v=[{title:"ФИО",key:"full_name"},{title:"Место прибытия",key:"arrival_place_name"},{title:"Дата создания заявки",key:"created_at"},{title:"Номер ТТН",key:"ttn_number"},{title:"Дата разгрузки",key:"unload_date"},{title:"Время начала разгрузки",key:"unload_start_time"},{title:"Статус",key:"status"},{title:"Действие",key:"interact"}];function D(g,_=!0){const n=new Date(g);if(isNaN(n.getTime()))return"-";const b=String(n.getDate()).padStart(2,"0"),y=String(n.getMonth()+1).padStart(2,"0"),d=n.getFullYear();if(!_)return`${b}.${y}.${d}`;const i=String(n.getHours()).padStart(2,"0"),p=String(n.getMinutes()).padStart(2,"0"),t=String(n.getSeconds()).padStart(2,"0");return`${b}.${y}.${d} ${i}:${p}:${t}`}const N={active:"План",accepted:"Завершена",rejected:"Отменена"},A={class:"driver"},I={class:"driver__table table"},R={class:"table__head"},F={class:"table__cell"},T={class:"table__text table__header"},j=["data-label"],H=["disabled","onClick"],M={key:1,class:"table__text"},P={class:"driver__mobile-table mobile-table"},V=["disabled","onClick"],q={class:"mobile-table__header"},E={class:"mobile-table__text"},L=C({__name:"applications",setup(g){const _=f(),n=$(),b=h(()=>_.getCurrentDriverRequestsById(n.currentDriverId)),y=_.getCurrentDriverById(n.currentDriverId).full_name,d=h(()=>[...b.value].sort((t,u)=>new Date(u.created_at).getTime()-new Date(t.created_at).getTime()).map(t=>({req_id:t.id,full_name:y,arrival_place_name:_.getArrivalPlaceNameById(n.currentArrivalPlaceId),created_at:D(t.created_at,!0),ttn_number:t.ttn_number,unload_date:D(t.unload_date,!1),unload_start_time:t.unload_start_time,status:N[t.status],interact:""}))),i=B(new Set);async function p(t){if(!i.value.has(t)){i.value.add(t);try{await _.cancelRequest(t)}finally{i.value.delete(t)}}}return(t,u)=>(e(),a("div",A,[r("table",I,[r("thead",R,[r("tr",null,[(e(!0),a(o,null,m(c(v),s=>(e(),a("th",F,[r("p",T,k(s.title),1)]))),256))])]),r("tbody",null,[(e(!0),a(o,null,m(c(d),s=>(e(),a("tr",{class:"table__row",key:s.ttn_number},[(e(!0),a(o,null,m(c(v),l=>(e(),a("td",{class:"table__cell","data-label":l.title},[l.key==="interact"&&s.status==="План"?(e(),a("button",{key:0,class:"table__button button",disabled:c(i).has(s.req_id),onClick:S=>p(s.req_id)},[...u[0]||(u[0]=[r("span",null,"Отменить",-1)])],8,H)):(e(),a("p",M,k(s[l.key]),1))],8,j))),256))]))),128))])]),r("div",P,[(e(!0),a(o,null,m(c(d),s=>(e(),a("div",{class:"mobile-table__row",key:s.ttn_number},[(e(!0),a(o,null,m(c(v),l=>(e(),a("div",{class:"mobile-table__cell",key:l.key},[l.key==="interact"?(e(),a(o,{key:0},[l.key==="interact"&&s.status==="План"?(e(),a("button",{key:0,class:"table__button button",disabled:c(i).has(s.req_id),onClick:S=>p(s.req_id)},[...u[1]||(u[1]=[r("span",null,"Отменить",-1)])],8,V)):x("",!0)],64)):(e(),a(o,{key:1},[r("p",q,k(l.title+":"),1),r("p",E,k(s[l.key]),1)],64))]))),128))]))),128))])]))}}),w=Object.assign(L,{__name:"DemoDriverApplications"});export{w as default};
